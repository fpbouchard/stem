<!DOCTYPE html>  <html> <head>   <title>view.js.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ajax.js.html">                 ajax.js.coffee               </a>                                           <a class="source" href="collection.js.html">                 collection.js.coffee               </a>                                           <a class="source" href="dom.js.html">                 dom.js.coffee               </a>                                           <a class="source" href="event.js.html">                 event.js.coffee               </a>                                           <a class="source" href="mixins.js.html">                 mixins.js.coffee               </a>                                           <a class="source" href="model.js.html">                 model.js.coffee               </a>                                           <a class="source" href="stem.js.html">                 stem.js.coffee               </a>                                           <a class="source" href="view.js.html">                 view.js.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               view.js.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">delegateDescriptorPattern = </span><span class="err">///</span>
  <span class="p">(</span><span class="err">\</span><span class="nx">S</span><span class="o">+</span><span class="p">)</span> <span class="c1"># Non-whitespace for the event name</span>
  <span class="err">\</span><span class="nx">s</span><span class="o">+</span>   <span class="c1"># Whitespace that splits the event name from the delegate selector</span>
  <span class="p">(.</span><span class="o">+</span><span class="p">)</span>  <span class="c1"># Delegate selector</span>
<span class="o">/</span><span class="err">//</span>

<span class="k">class</span> <span class="nx">Stem</span><span class="p">.</span><span class="nx">View</span>
  <span class="nx">@implements</span> <span class="nx">Stem</span><span class="p">.</span><span class="nx">Events</span>

  <span class="vi">@bindings = </span><span class="nf">(bindings) -&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@_bindings</span> <span class="o">||=</span> <span class="p">{},</span> <span class="nx">bindings</span>

  <span class="vi">@delegates = </span><span class="nf">(delegates) -&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@_delegates</span> <span class="o">||=</span> <span class="p">{},</span> <span class="nx">delegates</span>

  <span class="nv">constructor: </span><span class="nf">(attributes = {}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Views can be initialized with attributes</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="p">[</span><span class="nx">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="k">for</span> <span class="nx">attribute</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">attributes</span>
    <span class="k">throw</span> <span class="s2">&quot;Cannot bind to both a model and a collection&quot;</span> <span class="k">if</span> <span class="nx">@model</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="nx">@collection</span><span class="o">?</span>
    <span class="vi">@bindable = </span><span class="nx">@model</span> <span class="o">||</span> <span class="nx">@collection</span>
    <span class="nx">@_installBindings</span><span class="p">()</span>
    <span class="nx">@_resolveElement</span><span class="p">()</span>
    <span class="nx">@_installDelegates</span><span class="p">()</span>

  <span class="nv">_resolveElement: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@el</span>
    <span class="vi">@el = </span><span class="nx">Stem</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">@el</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span>

  <span class="nv">_installDelegates: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">_delegates</span><span class="o">?</span>
    <span class="k">for</span> <span class="nx">delegateDescriptor</span><span class="p">,</span> <span class="nx">handler</span> <span class="k">of</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">_delegates</span>
      <span class="nv">matches = </span><span class="nx">delegateDescriptor</span><span class="p">.</span><span class="nx">match</span> <span class="nx">delegateDescriptorPattern</span>
      <span class="k">throw</span> <span class="s2">&quot;Invalid delegate descriptor: \&quot;#{delegateDescriptor}\&quot;&quot;</span> <span class="nx">unless</span> <span class="nx">matches</span><span class="o">?</span>
      <span class="p">[</span><span class="nx">match</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">selector</span><span class="p">]</span> <span class="o">=</span> <span class="nx">matches</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Undefined delegate callback: \&quot;#{handler}\&quot;&quot;</span> <span class="nx">unless</span> <span class="nv">handler = </span><span class="err">@</span><span class="p">[</span><span class="nx">handler</span><span class="p">]</span>
      <span class="nx">Stem</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">delegate</span> <span class="nx">@el</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">handler</span>

  <span class="nv">_installBindings: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">_bindings</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="nx">@bindable</span>
    <span class="k">for</span> <span class="nx">eventDescriptor</span><span class="p">,</span> <span class="nx">handler</span> <span class="k">of</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">_bindings</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Undefined binding callback: \&quot;#{handler}\&quot;&quot;</span> <span class="nx">unless</span> <span class="nv">handler = </span><span class="err">@</span><span class="p">[</span><span class="nx">handler</span><span class="p">]</span>
      <span class="nx">@bindable</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">eventDescriptor</span><span class="p">,</span> <span class="nx">handler</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Internal call tied to the invalidate system</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_bindableChange: </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Invalidating binds only to the next model change event, unbind immediately</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@bindable</span><span class="p">.</span><span class="nx">unbind</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="nx">@_bindableChange</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Then render the view</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@render</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>A view can optionally bind model changes to the invalidate method. If so,
the view will automatically call render when all the individual model or
collection changes will be done. This way, one can listen to multiple
single-attribute changes and still re-render the view only once per call to
model#set.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">invalidate: </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Render once all bindable updates are done</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@bindable</span><span class="p">.</span><span class="nx">bind</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="nx">@_bindableChange</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Render is where the actual markup generation should take place. Any kind of
generation technique (DOM building, templating) can be used. Render should
return the view itself. Build on <code>@el</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="o">-&gt;</span> <span class="k">this</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
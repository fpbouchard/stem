<!DOCTYPE html>  <html> <head>   <title>model.js.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.js.html">                 base.js.coffee               </a>                                           <a class="source" href="coffeemvc.js.html">                 coffeemvc.js.coffee               </a>                                           <a class="source" href="event.js.html">                 event.js.coffee               </a>                                           <a class="source" href="model.js.html">                 model.js.coffee               </a>                                           <a class="source" href="view.js.html">                 view.js.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               model.js.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Models</h1>

<p><strong>Models</strong> hold data and binds <strong>events</strong> to change in data.</p>

<p><strong>Model</strong> subclasses can define their default attributes in their class definition by setting the <code>@defaults</code> class property.</p>

<p>Ex.:</p>

<pre><code>class Context extends Model
  @defaults
    mode: "standard"

context = new Context
expect(context.get "mode").toEqual "standard"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">CoffeeMVC</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nx">@implements</span> <span class="nx">CoffeeMVC</span><span class="p">.</span><span class="nx">Events</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The <strong>Model</strong> constructor also allows to set initial attributes in the model by passing the hash directly:</p>

<pre><code>context = new Context
  mode: "extended"

expect(context.get "mode").toEqual "extended"
</code></pre>

<p>Note that attributes passed at instanciation win over default, class-level values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(attributes = {}) -&gt;</span>
    <span class="nv">attributes = </span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">defaults</span>
    <span class="vi">@attributes = </span><span class="nx">attributes</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Get an attribute's value, by its key.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get: </span><span class="nf">(attribute) -&gt;</span>
    <span class="nx">@attributes</span><span class="p">[</span><span class="nx">attribute</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Set attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set: </span><span class="nf">(attributes) -&gt;</span>
    <span class="nv">changes = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Prevent reentrancy of the global change event (see below)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">wasChanging = </span><span class="nx">@_changing</span>
    <span class="vi">@_changing = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Allow hooks to sanitize/handle changes before they are committed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@beforeSet</span> <span class="nx">attributes</span> <span class="k">if</span> <span class="nx">@beforeSet</span><span class="o">?</span>

    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">attributes</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Only <em>changed</em> attributes set in the <code>attributes</code> hash will be actually changed. The comparison is done using <a href="http://documentcloud.github.com/underscore/">underscore.js</a>'s <code>isEqual</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span> <span class="nx">@attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Remember that this attribute changed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">changes</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Change it in the model</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Trigger a <em>specific</em> change event</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@trigger</span> <span class="s2">&quot;change:#{key}&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Avoid triggering multiple global "change" events. This way, if an event
handler further changes the model, this ensures that only one global
"change" event will be fired at the end of the scope of the first change.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">!</span><span class="nx">wasChanging</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Trigger the <em>global</em> change event. Only trigger change if any passed attribute actually changed</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@trigger</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">changes</span> <span class="k">if</span> <span class="nx">changes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Leave the global _changing flag on until the scope of the first change
wraps up (hence this line's enclosing in the <code>!wasChanging</code> condition)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@_changing = </span><span class="kc">false</span>

    <span class="k">this</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 